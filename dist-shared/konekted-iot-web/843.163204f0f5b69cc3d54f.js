"use strict";(self.webpackChunkkonekted_iot_web=self.webpackChunkkonekted_iot_web||[]).push([[843],{5843:(K,f,s)=>{s.r(f),s.d(f,{BillingModule:()=>z});var q=s(4026),x=s(6631),u=s(3771),r=s(665),l=s(8583),t=s(7716),I=s(1321),h=s(3002);function U(n,o){if(1&n&&(t.TgZ(0,"div",3),t.TgZ(1,"h3",4),t._uU(2,"Payment Receipt"),t.qZA(),t.TgZ(3,"h3",4),t._uU(4),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"div",5),t.TgZ(7,"table",6),t.TgZ(8,"tr"),t.TgZ(9,"th"),t._uU(10,"Payer"),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.qZA(),t.TgZ(13,"tr"),t.TgZ(14,"th"),t._uU(15,"Payment Receipt"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA(),t.qZA(),t.TgZ(18,"tr"),t.TgZ(19,"th"),t._uU(20,"Transaction Date"),t.qZA(),t.TgZ(21,"td"),t._uU(22),t.qZA(),t.qZA(),t.TgZ(23,"tr"),t.TgZ(24,"th"),t._uU(25,"Amount"),t.qZA(),t.TgZ(26,"td"),t._uU(27),t.ALo(28,"currency"),t.qZA(),t.qZA(),t.TgZ(29,"tr"),t.TgZ(30,"th"),t._uU(31,"Payment Description"),t.qZA(),t.TgZ(32,"td"),t._uU(33),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.xp6(4),t.Oqu(e.data.transaction_id),t.xp6(8),t.Oqu(e.data.full_name),t.xp6(5),t.Oqu(e.data.transaction_id),t.xp6(5),t.Oqu(e.data.transaction_date),t.xp6(5),t.Oqu(t.xi3(28,6,e.data.amount,"TZS")),t.xp6(6),t.Oqu(e.data.description)}}function C(n,o){1&n&&(t.TgZ(0,"div",7),t._uU(1,"No data found."),t.qZA())}let P=(()=>{class n{constructor(e,a){this.fn=e,this.dataIn=a}ngOnInit(){this.dataIn&&(this.data=this.dataIn)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(I.d),t.Y36(h.i))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-print-payments"]],decls:3,vars:2,consts:[["id","printContent"],["class","row",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"row"],[1,"text-center","mt-2"],[1,"table-responsive"],[1,"table","table-bordered","table-hover"],[1,"alert","alert-warning"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t.YNc(1,U,34,9,"div",1),t.YNc(2,C,2,0,"div",2),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",a.data),t.xp6(1),t.Q6J("ngIf",!a.data))},directives:[l.O5],pipes:[l.H9],styles:[""]}),n})();var g=s(8239),O=s(5145),D=s(474);let c=(()=>{class n{constructor(e,a){this.http=e,this.api=a}getPayments(e){var a=this;return(0,g.Z)(function*(){return yield a.http.post(a.api.billing.payments.getPayments,e,!1)})()}importPayments(e){var a=this;return(0,g.Z)(function*(){return yield a.http.post(a.api.billing.payments.payments,e,!0)})()}deletePayment(e){var a=this;return(0,g.Z)(function*(){return yield a.http.delete(a.api.billing.payments.payments,e,!0)})()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(O.$),t.LFG(D.s))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var T=s(4957),y=s(1244);function S(n,o){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"currency"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._UZ(13,"app-action-buttons",8),t.qZA(),t.qZA()),2&n){const e=o.$implicit,a=t.oxw(2);t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(t.xi3(5,13,e.amount,"TZS")),t.xp6(3),t.Oqu(e.transaction_id),t.xp6(2),t.Oqu(e.transaction_date),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.Q6J("headingPrint","Print Receipt")("modalPrintContent",a.modalPrintComponent)("data",e)("deleteAction",!1)("editAction",!1)("viewAction",!1)("printAction",!0)("modalPrintSize","lg")}}function w(n,o){if(1&n&&(t.TgZ(0,"tbody"),t.YNc(1,S,14,16,"tr",7),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.data)}}function N(n,o){1&n&&(t.TgZ(0,"tbody"),t.TgZ(1,"tr"),t.TgZ(2,"th",9),t._uU(3,"No data found."),t.qZA(),t.qZA(),t.qZA())}let F=(()=>{class n{constructor(e){this.paymentsService=e,this.dtOptions={},this.data=[],this.cols=["id","name","email","amount","transaction_id","transaction_date","description"],this.modalPrintComponent=P}ngOnInit(){this.dtOptions={pagingType:"full_numbers",pageLength:10,processing:!0,serverSide:!0,ajax:(e,a)=>{this.paymentsService.getPayments(e).then(i=>{this.data=i.data,a({recordsTotal:i.recordsTotal,recordsFiltered:i.recordsFiltered,data:[]})})},columns:[{data:"id"},{data:"amount"},{data:"transaction_id"},{data:"transaction_date"},{data:"description"},{data:"",orderable:!1}],responsive:!0}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-user-payments"]],decls:22,vars:3,consts:[[1,"card"],["id","htmlData",1,"table-responsive","py-4"],["htmlData",""],[1,"dataTable-wrapper","dataTable-loading","no-footer","fixed-columns"],["datatable","","id","htmlData",1,"table","table-flush","dataTable-table",3,"dtOptions"],[1,"thead-light"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"headingPrint","modalPrintContent","data","deleteAction","editAction","viewAction","printAction","modalPrintSize"],["colspan","3"]],template:function(e,a){1&e&&(t._UZ(0,"app-top-bar"),t.TgZ(1,"div",0),t.TgZ(2,"div",1,2),t.TgZ(4,"div",3),t.TgZ(5,"table",4),t.TgZ(6,"thead",5),t.TgZ(7,"tr"),t.TgZ(8,"th"),t._uU(9,"ID"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Amount"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Trx ID"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Trx Date"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Description"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Actions"),t.qZA(),t.qZA(),t.qZA(),t.YNc(20,w,2,1,"tbody",6),t.YNc(21,N,4,0,"tbody",6),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(5),t.Q6J("dtOptions",a.dtOptions),t.xp6(15),t.Q6J("ngIf",0!=(null==a.data?null:a.data.length)),t.xp6(1),t.Q6J("ngIf",0==(null==a.data?null:a.data.length)))},directives:[T.N,u.G,l.O5,l.sg,y.O],pipes:[l.H9],styles:[""]}),n})();var A=s(5120),_=s(1721);let J=(()=>{class n{constructor(e,a,i,m){this.modal=e,this.paymentService=a,this.loader=i,this.dataIn=m,this.form=new r.cw({paymentId:new r.NI("")})}ngOnInit(){this.dataIn&&(this.data=this.dataIn,this.form.setControl("paymentId",new r.NI(this.data.id)))}get paymentId(){return this.form.get("paymentId")}onSubmit(){var e;this.paymentService.deletePayment(null===(e=this.paymentId)||void 0===e?void 0:e.value).then(a=>{a.error||(this.modal.close(),this.loader.refresh())})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(A.F),t.Y36(c),t.Y36(_.D),t.Y36(h.i))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-delete-payments"]],decls:8,vars:4,consts:[[3,"formGroup","ngSubmit"],[1,"w-100","btn","btn-lg","btn-danger",3,"type"],[1,"bi","bi-trash"]],template:function(e,a){1&e&&(t.TgZ(0,"p"),t._uU(1," Delete payment?"),t._UZ(2,"br"),t._UZ(3,"br"),t.qZA(),t.TgZ(4,"form",0),t.NdJ("ngSubmit",function(){return a.onSubmit()}),t.TgZ(5,"button",1),t._uU(6," Delete "),t._UZ(7,"i",2),t.qZA(),t.qZA()),2&e&&(t.xp6(4),t.Q6J("formGroup",a.form),t.xp6(1),t.ekj("disabled",a.form.invalid),t.Q6J("type",a.form.valid?"submit":"button"))},directives:[r._Y,r.JL,r.sg],styles:[""]}),n})();var p=s(8618);function Y(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",7),t.TgZ(1,"input",8),t.NdJ("change",function(i){return t.CHM(e),t.oxw().onFileChange(i)}),t.qZA(),t.TgZ(2,"label",9),t._uU(3,"Upload Payment Data"),t.qZA(),t.qZA()}}function Q(n,o){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=o.$implicit,a=o.index,i=t.oxw(2);t.xp6(1),t.Oqu(e+(a!==i.importColumns.length-1?", ":""))}}function B(n,o){if(1&n&&(t.TgZ(0,"div",10),t._uU(1," Excel/CSV File contains invalid columns, excel file must have the following columns ("),t.YNc(2,Q,2,1,"span",11),t._uU(3,") "),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngForOf",e.importColumns)}}let E=(()=>{class n{constructor(e,a,i){this.paymentsService=e,this.modal=a,this.loader=i,this.users=[],this.userSensors=[],this.excelExportData=[],this.excelImportData=[],this.approvedToImport=!1,this.importColumns=["EMAIL","TRANSACTION_ID","TRANSACTION_DATE","AMOUNT","DESCRIPTION"],this.form=new r.cw({}),this.onSubmit=()=>{this.paymentsService.importPayments({paymentData:this.excelImportData}).then(Z=>{Z.error||(this.modal.close(),this.loader.refresh())})}}ngOnInit(){for(let e=0;e<2;e++)this.excelExportData.push({EMAIL:"mtwange@gmail.com",TRANSACTION_ID:"CRDB/001/2031/"+(new Date).getTime(),TRANSACTION_DATE:new Date,AMOUNT:Math.round(1e4*Math.random()),DESCRIPTION:"Malipo ya Umeme"})}downloadExcel(){let e=p.utils.book_new();p.utils.book_append_sheet(e,p.utils.json_to_sheet(this.excelExportData)),p.writeFile(e,`payments_sample_file_${(new Date).getTime()}.xlsx`,{})}onFileChange(e){this.excelImportData=[],this.file=e.target.files[0];const a=new FileReader;a.readAsArrayBuffer(this.file),this.fileName=this.file.name,a.onload=()=>{this.arrayBuffer=a.result;const i=new Uint8Array(this.arrayBuffer),m=[];for(let d=0;d!==i.length;++d)m[d]=String.fromCharCode(i[d]);const Z=m.join(""),b=p.read(Z,{type:"binary",cellDates:!0}),H=p.utils.sheet_to_json(b.Sheets[b.SheetNames[0]],{raw:!0});for(const d of H)this.importColumns.forEach(V=>{this.approvedToImport=!!d[V]}),this.approvedToImport&&this.excelImportData.push(d)}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c),t.Y36(A.F),t.Y36(_.D))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-import-payments"]],decls:9,vars:6,consts:[["autocomplete","off",1,"p-1",3,"formGroup","ngSubmit"],["type","button",1,"btn","btn-link","btn-block","mb-4","w-100",3,"click"],[1,"bi","bi-download"],["class","form-floating mb-3",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],[1,"w-100","btn","btn-danger",3,"type"],[1,"bi","bi-check-circle"],[1,"form-floating","mb-3"],["type","file","accept",".csv,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","placeholder","Upload Test Data","id","floatingFile",1,"form-control",3,"change"],["for","floatingFile"],[1,"alert","alert-warning"],[4,"ngFor","ngForOf"]],template:function(e,a){1&e&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.onSubmit()}),t.TgZ(1,"button",1),t.NdJ("click",function(){return a.downloadExcel()}),t._UZ(2,"i",2),t._uU(3," Download Sample Excel File "),t.qZA(),t.YNc(4,Y,4,0,"div",3),t.YNc(5,B,4,1,"div",4),t.TgZ(6,"button",5),t._uU(7," Import Test Data "),t._UZ(8,"i",6),t.qZA(),t.qZA()),2&e&&(t.Q6J("formGroup",a.form),t.xp6(4),t.Q6J("ngIf",a.excelExportData.length>0),t.xp6(1),t.Q6J("ngIf",!a.approvedToImport&&a.file),t.xp6(1),t.ekj("disabled",!a.form.valid||0==a.excelImportData.length),t.Q6J("type",a.form.valid?"submit":"button"))},directives:[r._Y,r.JL,r.sg,l.O5,l.sg],styles:[""]}),n})();function M(n,o){if(1&n&&(t.TgZ(0,"tr"),t.TgZ(1,"th"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.ALo(9,"currency"),t.qZA(),t.TgZ(10,"td"),t._uU(11),t.qZA(),t.TgZ(12,"td"),t._uU(13),t.qZA(),t.TgZ(14,"td"),t._uU(15),t.qZA(),t.TgZ(16,"td"),t._UZ(17,"app-action-buttons",9),t.qZA(),t.qZA()),2&n){const e=o.$implicit,a=t.oxw(2);t.xp6(2),t.Oqu(e.id),t.xp6(2),t.Oqu(e.full_name),t.xp6(2),t.Oqu(e.email),t.xp6(2),t.Oqu(t.xi3(9,11,e.amount,"TZS")),t.xp6(3),t.Oqu(e.transaction_id),t.xp6(2),t.Oqu(e.transaction_date),t.xp6(2),t.Oqu(e.description),t.xp6(2),t.Q6J("modalDeleteContent",a.modalDeleteComponent)("data",e)("viewAction",!1)("editAction",!1)}}function R(n,o){if(1&n&&(t.TgZ(0,"tbody"),t.YNc(1,M,18,14,"tr",8),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.data)}}function j(n,o){1&n&&(t.TgZ(0,"tbody"),t.TgZ(1,"tr"),t.TgZ(2,"th",10),t._uU(3,"No data found."),t.qZA(),t.qZA(),t.qZA())}let L=(()=>{class n{constructor(e){this.paymentsService=e,this.dtOptions={},this.data=[],this.cols=["id","full_name","email","amount","transaction_id","transaction_date","description"],this.modalImportComponent=E,this.modalDeleteComponent=J}ngOnInit(){this.dtOptions={pagingType:"full_numbers",pageLength:10,processing:!0,serverSide:!0,ajax:(e,a)=>{Object.assign(e,Object.assign(Object.assign({},e),{allRecords:!0})),this.paymentsService.getPayments(e).then(i=>{this.data=i.data,a({recordsTotal:i.recordsTotal,recordsFiltered:i.recordsFiltered,data:[]})})},columns:[{data:"id"},{data:"full_name"},{data:"email"},{data:"amount"},{data:"transaction_id"},{data:"transaction_date"},{data:"description"},{data:"",orderable:!1}],responsive:!0}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(c))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-payments"]],decls:26,vars:6,consts:[[3,"importButton","importButtonName","importModalContent"],[1,"card"],["id","htmlData",1,"table-responsive","py-4"],["htmlData",""],[1,"dataTable-wrapper","dataTable-loading","no-footer","fixed-columns"],["datatable","","id","htmlData",1,"table","table-flush","dataTable-table",3,"dtOptions"],[1,"thead-light"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"modalDeleteContent","data","viewAction","editAction"],["colspan","3"]],template:function(e,a){1&e&&(t._UZ(0,"app-top-bar",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2,3),t.TgZ(4,"div",4),t.TgZ(5,"table",5),t.TgZ(6,"thead",6),t.TgZ(7,"tr"),t.TgZ(8,"th"),t._uU(9,"ID"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Name"),t.qZA(),t.TgZ(12,"th"),t._uU(13,"Email"),t.qZA(),t.TgZ(14,"th"),t._uU(15,"Amount"),t.qZA(),t.TgZ(16,"th"),t._uU(17,"Trx ID"),t.qZA(),t.TgZ(18,"th"),t._uU(19,"Trx Date"),t.qZA(),t.TgZ(20,"th"),t._uU(21,"Description"),t.qZA(),t.TgZ(22,"th"),t._uU(23,"Actions"),t.qZA(),t.qZA(),t.qZA(),t.YNc(24,R,2,1,"tbody",7),t.YNc(25,j,4,0,"tbody",7),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.Q6J("importButton",!0)("importButtonName","Import Payment Data from Excel/CSV")("importModalContent",a.modalImportComponent),t.xp6(5),t.Q6J("dtOptions",a.dtOptions),t.xp6(19),t.Q6J("ngIf",0!=(null==a.data?null:a.data.length)),t.xp6(1),t.Q6J("ngIf",0==(null==a.data?null:a.data.length)))},directives:[T.N,u.G,l.O5,l.sg,y.O],pipes:[l.H9],styles:[""]}),n})();var v=s(4330);const G=[{path:"payments",component:L},{path:"user-payments",component:F}];let k=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[v.Bz.forChild(G)],v.Bz]}),n})(),z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[l.ez,r.UX,u.T,x.E,q.j,k]]}),n})()}}]);